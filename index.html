<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Maths 2: Analyse Interactive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Configuration MathJax pour les formules -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfcf8;
            color: #334155;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Styles sp√©cifiques pour le graphe Markov */
        .markov-graph-container {
            width: 100%;
            height: 250px; /* Hauteur fixe pour le dessin */
            background-color: #ffffff;
            border-radius: 0.75rem;
            position: relative;
        }
        
        .matrix-bracket {
            position: relative;
            padding: 0.5rem;
        }
        .matrix-bracket::before, .matrix-bracket::after {
            content: "";
            position: absolute;
            top: 0;
            bottom: 0;
            width: 10px; /* Un peu plus large pour 3x3 */
            border: 2px solid #334155;
        }
        .matrix-bracket::before { left: 0; border-right: 0; }
        .matrix-bracket::after { right: 0; border-left: 0; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .tab-content {
            display: none; 
            animation: fadeIn 0.4s ease-in-out;
        }
        .tab-content.active {
            display: block; 
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-num:focus {
            outline: none;
            border-color: #d97706;
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
        }
        
        /* Ajustement inputs pour grille 3x3 */
        .input-num {
            font-size: 0.85rem;
            padding: 2px;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 3px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <nav class="bg-[#f4f1ea] border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center gap-2">
                        <span class="text-2xl font-bold text-stone-800 tracking-tight">Maths<span class="text-amber-600">II</span></span>
                        <span class="text-xs font-semibold uppercase tracking-wider text-stone-500 mt-1 ml-2 hidden sm:block">Matrices & Graphes</span>
                    </div>
                </div>
                <div class="hidden sm:flex sm:space-x-8 items-center">
                    <button onclick="switchTab('home')" id="nav-home" class="nav-item border-amber-500 text-stone-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors duration-200">Synth√®se & Cours</button>
                    <button onclick="switchTab('matrices')" id="nav-matrices" class="nav-item border-transparent text-stone-500 hover:border-stone-300 hover:text-stone-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors duration-200">Matrices</button>
                    <button onclick="switchTab('graphes')" id="nav-graphes" class="nav-item border-transparent text-stone-500 hover:border-stone-300 hover:text-stone-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors duration-200">Graphes</button>
                    <button onclick="switchTab('markov')" id="nav-markov" class="nav-item border-transparent text-stone-500 hover:border-stone-300 hover:text-stone-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors duration-200">Cha√Ænes de Markov</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- SECTION: HOME -->
        <section id="home" class="tab-content active">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold text-stone-900 mb-4">Module Maths 2 : Synth√®se & R√©vision</h1>
                <p class="text-lg text-stone-600 max-w-3xl mx-auto leading-relaxed">
                    Explorez les concepts cl√©s de l'alg√®bre lin√©aire, des graphes et des probabilit√©s.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 hover:shadow-md transition-shadow cursor-pointer group" onclick="switchTab('matrices')">
                    <div class="w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center mb-4 text-amber-600 font-bold text-xl group-hover:scale-110 transition-transform">M</div>
                    <h2 class="text-xl font-bold text-stone-900 mb-2">Matrices</h2>
                    <p class="text-stone-600 text-sm mb-4">Tableaux de nombres $M_{n,p}(\mathbb{R})$, op√©rations, d√©terminants.</p>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 hover:shadow-md transition-shadow cursor-pointer group" onclick="switchTab('graphes')">
                    <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center mb-4 text-emerald-600 font-bold text-xl group-hover:scale-110 transition-transform">G</div>
                    <h2 class="text-xl font-bold text-stone-900 mb-2">Graphes</h2>
                    <p class="text-stone-600 text-sm mb-4">Mod√©lisation, Dijkstra, et optimisation de chemins.</p>
                </div>
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 hover:shadow-md transition-shadow cursor-pointer group" onclick="switchTab('markov')">
                    <div class="w-12 h-12 bg-sky-100 rounded-lg flex items-center justify-center mb-4 text-sky-600 font-bold text-xl group-hover:scale-110 transition-transform">P</div>
                    <h2 class="text-xl font-bold text-stone-900 mb-2">Cha√Ænes de Markov</h2>
                    <p class="text-stone-600 text-sm mb-4">Processus sans m√©moire, matrices de transition et convergence.</p>
                </div>
            </div>

            <div class="bg-white border border-stone-200 rounded-xl overflow-hidden shadow-sm">
                <div class="bg-stone-50 px-6 py-4 border-b border-stone-200">
                    <h3 class="font-bold text-xl text-stone-800 flex items-center"><span class="text-2xl mr-2">üìù</span> Fiche de R√©vision : Les Cha√Ænes de Markov</h3>
                </div>
                <div class="p-8 space-y-8 text-stone-700">
                    <div>
                        <h4 class="text-lg font-bold text-amber-600 mb-3 border-b border-amber-100 pb-1">1. Notions Fondamentales</h4>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-stone-50 p-4 rounded-lg">
                                <h5 class="font-bold text-stone-800 mb-2">A. Le Graphe Probabiliste</h5>
                                <ul class="list-disc pl-5 text-sm space-y-1">
                                    <li>Graphe <strong>orient√©</strong> et <strong>pond√©r√©</strong>.</li>
                                    <li>Sommets = <strong>√âtats</strong> du syst√®me.</li>
                                    <li>Poids des arcs = <strong>Probabilit√©s</strong>.</li>
                                    <li><strong class="text-amber-700">R√®gle d'or :</strong> La somme des poids sortant d'un sommet vaut toujours 1.</li>
                                </ul>
                            </div>
                            <div class="bg-stone-50 p-4 rounded-lg">
                                <h5 class="font-bold text-stone-800 mb-2">B. L'√âtat Probabiliste</h5>
                                <p class="text-sm mb-2">Vecteur ligne √† l'instant $n$ :</p>
                                <div class="text-center py-2 bg-white rounded border border-stone-200 text-sm">$$ P_n = (a_1 \quad a_2 \quad \dots \quad a_m) $$</div>
                                <p class="text-xs text-stone-500 mt-2 text-center">Avec $ \sum a_i = 1 $</p>
                            </div>
                        </div>
                    </div>

                    <!-- EXEMPLE DE CALCUL -->
                    <div class="bg-amber-50 border border-amber-100 rounded-lg p-6">
                        <h4 class="text-lg font-bold text-amber-800 mb-3 flex items-center">
                            <span class="mr-2">üí°</span> Exemple de Calcul : $P_0$ et $P_1$
                        </h4>
                        
                        <!-- CAS 2x2 -->
                        <div class="mb-6 border-b border-amber-200 pb-6">
                            <h5 class="font-bold text-stone-800 mb-2 inline-block bg-white px-2 rounded">Cas A : Matrice 2x2</h5>
                            
                            <div class="mt-2">
                                <p class="text-sm text-stone-700 mb-1"><strong>1. Calcul de $P_0$</strong></p>
                                <ul class="list-disc pl-5 text-sm text-stone-600 mb-2">
                                    <li>√ânonc√© : "60% en A, 40% en B"</li>
                                    <li>$P_0 = (0,6 \quad 0,4)$</li>
                                </ul>

                                <p class="text-sm text-stone-700 mb-1"><strong>2. Calcul de $P_1$</strong></p>
                                <div class="overflow-x-auto">
                                    <p class="text-sm font-mono bg-white p-3 rounded border border-amber-200">
                                        $ P_1 = P_0 \times T = (0,6 \quad 0,4) \times \begin{pmatrix} 0,9 & 0,1 \\ 0,05 & 0,95 \end{pmatrix} $
                                        <br><br>
                                        $ = ( \underbrace{0,6 \times 0,9 + 0,4 \times 0,05}_{\text{Pour A}} \quad ; \quad \underbrace{0,6 \times 0,1 + 0,4 \times 0,95}_{\text{Pour B}} ) $
                                        <br>
                                        $ = ( 0,56 \quad 0,44 ) $
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- CAS 3x3 -->
                        <div>
                            <h5 class="font-bold text-stone-800 mb-2 inline-block bg-white px-2 rounded">Cas B : Matrice 3x3 (3 √âtats)</h5>
                            
                            <div class="mt-2">
                                <p class="text-sm text-stone-700 mb-1"><strong>1. Calcul de $P_0$</strong></p>
                                <ul class="list-disc pl-5 text-sm text-stone-600 mb-2">
                                    <li>√ânonc√© : "20% en A, 30% en B, 50% en C"</li>
                                    <li>$P_0 = (0,2 \quad 0,3 \quad 0,5)$ (La somme vaut bien 1)</li>
                                </ul>

                                <p class="text-sm text-stone-700 mb-1"><strong>2. Calcul de $P_1$</strong></p>
                                <p class="text-xs text-stone-500 mb-2 italic">On multiplie le vecteur ligne (1x3) par la matrice carr√©e (3x3).</p>
                                
                                <div class="overflow-x-auto">
                                    <p class="text-sm font-mono bg-white p-3 rounded border border-amber-200">
                                        $ T = \begin{pmatrix} 0,5 & 0,2 & 0,3 \\ 0,1 & 0,8 & 0,1 \\ 0,4 & 0,2 & 0,4 \end{pmatrix} $
                                        <br><br>
                                        $ P_1 = (a_1 \quad b_1 \quad c_1) $ o√π :
                                        <br>
                                        $ a_1 = 0,2 \times 0,5 + 0,3 \times 0,1 + 0,5 \times 0,4 = 0,10 + 0,03 + 0,20 = \mathbf{0,33} $
                                        <br>
                                        $ b_1 = 0,2 \times 0,2 + 0,3 \times 0,8 + 0,5 \times 0,2 = 0,04 + 0,24 + 0,10 = \mathbf{0,38} $
                                        <br>
                                        $ c_1 = 0,2 \times 0,3 + 0,3 \times 0,1 + 0,5 \times 0,4 = 0,06 + 0,03 + 0,20 = \mathbf{0,29} $
                                        <br><br>
                                        Soit $ P_1 = (0,33 \quad 0,38 \quad 0,29) $
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-lg font-bold text-amber-600 mb-3 border-b border-amber-100 pb-1">3. La Matrice de Transition $T$</h4>
                            <p class="text-sm mb-2">C'est une matrice carr√©e $m \times m$.</p>
                            <ul class="list-disc pl-5 text-sm space-y-1">
                                <li>$t_{ij}$ = Probabilit√© de passer de l'√©tat $i$ √† l'√©tat $j$.</li>
                                <li>Lecture : <strong>"De la Ligne... Vers la Colonne"</strong>.</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-amber-600 mb-3 border-b border-amber-100 pb-1">4. Formules</h4>
                            <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-100 text-center">
                                <span class="text-xl font-bold text-stone-800">$ P_{n+1} = P_n \times T $</span>
                                <br><span class="text-sm">$ P_n = P_0 \times T^n $</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: MATRICES (3x3 Updated) -->
        <section id="matrices" class="tab-content">
            <div class="mb-8 border-b border-stone-200 pb-4">
                <h2 class="text-3xl font-bold text-stone-800">L'Atelier des Matrices</h2>
                <p class="text-stone-600 mt-2">Focus sur les matrices carr√©es $3 \times 3$ : Produit et D√©terminant.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-200">
                    <h3 class="text-lg font-bold text-stone-800 mb-6 flex items-center"><span class="w-2 h-2 bg-amber-500 rounded-full mr-2"></span>Calculateur Interactif $(A \times B)$</h3>
                    
                    <div class="flex flex-col items-center justify-center gap-6 mb-8 overflow-x-auto">
                        <!-- Row 1: Matrices inputs -->
                        <div class="flex flex-row items-center gap-4">
                            <!-- Matrix A -->
                            <div class="text-center">
                                <div class="font-bold text-stone-400 mb-2 text-xs uppercase">Matrice A</div>
                                <div class="matrix-bracket grid grid-cols-3 gap-1">
                                    <input type="number" id="a11" value="1" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="a12" value="2" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="a13" value="3" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    
                                    <input type="number" id="a21" value="0" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="a22" value="1" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="a23" value="4" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    
                                    <input type="number" id="a31" value="5" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="a32" value="6" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="a33" value="0" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                </div>
                            </div>

                            <div class="text-xl font-bold text-stone-300">√ó</div>

                            <!-- Matrix B -->
                            <div class="text-center">
                                <div class="font-bold text-stone-400 mb-2 text-xs uppercase">Matrice B</div>
                                <div class="matrix-bracket grid grid-cols-3 gap-1">
                                    <input type="number" id="b11" value="-1" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="b12" value="0" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="b13" value="0" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    
                                    <input type="number" id="b21" value="0" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="b22" value="-1" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="b23" value="0" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    
                                    <input type="number" id="b31" value="0" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="b32" value="0" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                    <input type="number" id="b33" value="1" class="input-num w-10 h-8 text-center bg-stone-50 border border-stone-300 rounded" oninput="calculateMatrix()">
                                </div>
                            </div>
                        </div>

                        <div class="text-xl font-bold text-stone-300">=</div>

                        <!-- Result C -->
                        <div class="text-center">
                            <div class="font-bold text-amber-600 mb-2 text-xs uppercase">R√©sultat C</div>
                            <div class="matrix-bracket grid grid-cols-3 gap-1 bg-amber-50/50">
                                <div id="c11" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                                <div id="c12" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                                <div id="c13" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                                
                                <div id="c21" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                                <div id="c22" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                                <div id="c23" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                                
                                <div id="c31" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                                <div id="c32" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                                <div id="c33" class="w-10 h-8 flex items-center justify-center font-bold text-stone-800 text-xs"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-stone-50 p-4 rounded text-sm text-stone-600 border border-stone-100">
                        <strong class="block mb-2 text-stone-800">D√©tail du calcul pour $C_{1,1}$ :</strong>
                        <span id="calc-detail" class="font-mono text-amber-700 text-sm"></span>
                    </div>
                </div>
                <div class="space-y-6">
                    <div class="bg-white p-5 rounded-lg border border-stone-200 shadow-sm">
                        <h4 class="text-xs font-bold text-stone-500 uppercase tracking-wider mb-4 border-b pb-2">D√©terminants (Sarrus)</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center">
                                <span class="text-xs text-stone-400 font-semibold block mb-1">Det(A)</span>
                                <div id="det-a" class="text-xl font-bold text-stone-800 font-mono"></div>
                            </div>
                            <div class="text-center border-l border-stone-100">
                                <span class="text-xs text-stone-400 font-semibold block mb-1">Det(B)</span>
                                <div id="det-b" class="text-xl font-bold text-stone-800 font-mono"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: GRAPHES -->
        <section id="graphes" class="tab-content">
            <div class="mb-8 border-b border-stone-200 pb-4">
                <h2 class="text-3xl font-bold text-stone-800">Le Labo des Graphes</h2>
                <p class="text-stone-600 mt-2">Algorithme de <strong>Dijkstra</strong> : Plus court chemin de <span class="font-bold text-emerald-600">S</span> √† <span class="font-bold text-red-600">E</span>.</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Visualizer -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-stone-200 p-1 relative flex flex-col items-center">
                    <div class="absolute top-4 left-4 z-10 flex space-x-2">
                        <button onclick="resetDijkstra()" class="bg-stone-100 hover:bg-stone-200 text-stone-600 px-3 py-1 rounded text-sm font-medium border border-stone-300">R√©initialiser</button>
                        <button onclick="stepDijkstra()" id="btn-step" class="bg-amber-500 hover:bg-amber-600 text-white px-3 py-1 rounded text-sm font-medium shadow-sm">√âtape Suivante</button>
                    </div>
                    <!-- IMPORTANT: ID added to container for sizing logic -->
                    <div class="chart-container" id="graphContainer">
                        <canvas id="graphCanvas"></canvas>
                    </div>
                </div>

                <!-- Explanation Panel -->
                <div class="bg-stone-50 p-6 rounded-xl border border-stone-100 h-full flex flex-col">
                    <h3 class="font-bold text-stone-800 mb-4 text-lg">√âtat de l'Algorithme</h3>
                    <div id="dijkstra-status" class="space-y-3 flex-grow overflow-y-auto max-h-60 pr-2 custom-scrollbar">
                        <p class="text-sm text-stone-600 italic bg-white p-2 rounded border border-stone-200">Cliquez sur "√âtape Suivante" pour lancer l'algorithme.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: MARKOV -->
        <section id="markov" class="tab-content">
            <div class="mb-8 border-b border-stone-200 pb-4">
                <h2 class="text-3xl font-bold text-stone-800">Simulateur de Markov</h2>
                <p class="text-stone-600 mt-2">Formule cl√© : $ P_{n+1} = P_n \times T $.</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Controls -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-stone-200 lg:col-span-1">
                    <h3 class="font-bold text-stone-800 mb-4 text-lg">Param√®tres de Transition</h3>
                    
                    <div class="mb-6">
                        <label class="block text-xs font-bold text-stone-500 uppercase mb-2 tracking-wide">Matrice de Transition $T$</label>
                        <div class="grid grid-cols-2 gap-3 text-center text-sm">
                            <div class="p-3 bg-stone-50 border border-stone-200 rounded-lg">
                                <span class="block text-stone-400 text-xs mb-1">A vers A</span>
                                <input type="number" id="t-aa" value="0.9" step="0.05" min="0" max="1" class="w-full text-center bg-transparent font-bold text-amber-600 outline-none text-lg" onchange="updateMarkov()">
                            </div>
                            <div class="p-3 bg-stone-50 border border-stone-200 rounded-lg">
                                <span class="block text-stone-400 text-xs mb-1">A vers B</span>
                                <span id="t-ab" class="block font-bold text-stone-500 text-lg">0.1</span>
                            </div>
                            <div class="p-3 bg-stone-50 border border-stone-200 rounded-lg">
                                <span class="block text-stone-400 text-xs mb-1">B vers A</span>
                                <input type="number" id="t-ba" value="0.2" step="0.05" min="0" max="1" class="w-full text-center bg-transparent font-bold text-emerald-600 outline-none text-lg" onchange="updateMarkov()">
                            </div>
                            <div class="p-3 bg-stone-50 border border-stone-200 rounded-lg">
                                <span class="block text-stone-400 text-xs mb-1">B vers B</span>
                                <span id="t-bb" class="block font-bold text-stone-500 text-lg">0.8</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6 pt-4 border-t border-stone-100">
                        <label class="block text-xs font-bold text-stone-500 uppercase mb-2 tracking-wide">√âtat Initial $P_0$</label>
                        <div class="flex items-center gap-3">
                            <span class="text-sm font-bold text-amber-600 w-12">A: <span id="p0-a-val">0.6</span></span>
                            <input type="range" id="p0-slider" min="0" max="1" step="0.1" value="0.6" class="flex-grow h-2 bg-stone-200 rounded-lg appearance-none cursor-pointer accent-amber-500" oninput="updateMarkov()">
                            <span class="text-sm font-bold text-emerald-600 w-12 text-right">B: <span id="p0-b-val">0.4</span></span>
                        </div>
                    </div>
                </div>

                <!-- Visualization Panel (Right Side) -->
                <div class="lg:col-span-2 space-y-6">
                    
                    <!-- NEW: Graphe Probabiliste Interactif -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-200 flex flex-col items-center">
                        <h3 class="font-bold text-stone-800 mb-2 w-full text-left ml-2 text-lg">Visualisation du Graphe Probabiliste</h3>
                        <div class="markov-graph-container" id="markovGraphContainer">
                            <canvas id="markovGraphCanvas"></canvas>
                        </div>
                        <p class="text-xs text-stone-500 italic mt-2">Le graphe se met √† jour automatiquement selon la matrice T.</p>
                    </div>

                    <!-- Convergence Chart -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-200 flex flex-col justify-center">
                        <h3 class="font-bold text-stone-800 mb-2 ml-2 text-lg">Convergence des Probabilit√©s ($P_n$)</h3>
                        <div class="chart-container">
                            <canvas id="markovChart"></canvas>
                        </div>
                        <div class="mt-4 text-center">
                            <span class="inline-block px-3 py-1 bg-amber-50 text-amber-800 text-xs rounded-full font-bold border border-amber-100 mr-2">
                                √âtat Stable (A): <span id="stable-a">--</span>
                            </span>
                            <span class="inline-block px-3 py-1 bg-emerald-50 text-emerald-800 text-xs rounded-full font-bold border border-emerald-100">
                                √âtat Stable (B): <span id="stable-b">--</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white border-t border-stone-200 mt-auto">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <p class="text-center text-sm text-stone-400">G√©n√©r√© pour le module Maths 2.</p>
        </div>
    </footer>

    <script>
        // --- NAVIGATION STATE ---
        function switchTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            // Show selected tab
            document.getElementById(tabId).classList.add('active');

            // Update nav styling
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('border-amber-500', 'text-stone-900');
                el.classList.add('border-transparent', 'text-stone-500');
            });
            const activeNav = document.getElementById('nav-' + tabId);
            if(activeNav) {
                activeNav.classList.remove('border-transparent', 'text-stone-500');
                activeNav.classList.add('border-amber-500', 'text-stone-900');
            }

            // --- CORRECTIF POUR L'AFFICHAGE DES GRAPHIQUES ---
            if (tabId === 'graphes') {
                requestAnimationFrame(() => {
                    resizeGraphCanvas();
                    drawGraph();
                });
            }
            if (tabId === 'markov') {
                requestAnimationFrame(() => {
                    updateMarkov(); 
                });
            }
        }

        // --- SECTION 1: MATRICES LOGIC (3x3) ---
        function calculateMatrix() {
            const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
            
            // Get Matrix A
            const a11 = getVal('a11'), a12 = getVal('a12'), a13 = getVal('a13');
            const a21 = getVal('a21'), a22 = getVal('a22'), a23 = getVal('a23');
            const a31 = getVal('a31'), a32 = getVal('a32'), a33 = getVal('a33');

            // Get Matrix B
            const b11 = getVal('b11'), b12 = getVal('b12'), b13 = getVal('b13');
            const b21 = getVal('b21'), b22 = getVal('b22'), b23 = getVal('b23');
            const b31 = getVal('b31'), b32 = getVal('b32'), b33 = getVal('b33');

            // Calculate C = A * B (3x3 multiplication)
            // Row 1
            const c11 = a11*b11 + a12*b21 + a13*b31;
            const c12 = a11*b12 + a12*b22 + a13*b32;
            const c13 = a11*b13 + a12*b23 + a13*b33;
            // Row 2
            const c21 = a21*b11 + a22*b21 + a23*b31;
            const c22 = a21*b12 + a22*b22 + a23*b32;
            const c23 = a21*b13 + a22*b23 + a23*b33;
            // Row 3
            const c31 = a31*b11 + a32*b21 + a33*b31;
            const c32 = a31*b12 + a32*b22 + a33*b32;
            const c33 = a31*b13 + a32*b23 + a33*b33;

            // Update Results UI
            const updateC = (id, val) => document.getElementById(id).innerText = parseFloat(val.toFixed(2));
            updateC('c11', c11); updateC('c12', c12); updateC('c13', c13);
            updateC('c21', c21); updateC('c22', c22); updateC('c23', c23);
            updateC('c31', c31); updateC('c32', c32); updateC('c33', c33);

            // Update Detail for C11
            const detailHtml = `${a11}√ó${b11} + ${a12}√ó${b21} + ${a13}√ó${b31} = <span class="font-bold border-b-2 border-amber-400">${c11}</span>`;
            document.getElementById('calc-detail').innerHTML = detailHtml;

            // Determinants (Rule of Sarrus)
            // det = a11(a22a33 - a23a32) - a12(a21a33 - a23a31) + a13(a21a32 - a22a31)
            const calcDet = (m11, m12, m13, m21, m22, m23, m31, m32, m33) => {
                return m11 * (m22*m33 - m23*m32) 
                     - m12 * (m21*m33 - m23*m31) 
                     + m13 * (m21*m32 - m22*m31);
            };

            const detA = calcDet(a11, a12, a13, a21, a22, a23, a31, a32, a33);
            const detB = calcDet(b11, b12, b13, b21, b22, b23, b31, b32, b33);

            document.getElementById('det-a').innerText = parseFloat(detA.toFixed(2));
            document.getElementById('det-b').innerText = parseFloat(detB.toFixed(2));
        }

        // --- SECTION 2: GRAPH (DIJKSTRA) LOGIC ---
        const graphCanvas = document.getElementById('graphCanvas');
        const ctxGraph = graphCanvas.getContext('2d');
        
        const nodes = {
            'S': {x: 100, y: 200, label: 'S'},
            'A': {x: 250, y: 100, label: 'A'},
            'B': {x: 250, y: 300, label: 'B'},
            'I': {x: 400, y: 200, label: 'I'},
            'E': {x: 550, y: 200, label: 'E'}
        };

        const edges = [
            {from: 'S', to: 'A', weight: 12}, {from: 'S', to: 'B', weight: 9},
            {from: 'A', to: 'I', weight: 30}, {from: 'B', to: 'I', weight: 25},
            {from: 'B', to: 'A', weight: 5}, {from: 'I', to: 'E', weight: 16},
            {from: 'A', to: 'E', weight: 40}
        ];

        let dijkstraState = { step: 0, distances: {}, visited: [], current: null };

        function resizeGraphCanvas() {
            const container = document.getElementById('graphContainer');
            // Si l'onglet est masqu√©, largeur est 0, on annule
            if (container.clientWidth === 0) return;
            
            const dpr = window.devicePixelRatio || 1;
            graphCanvas.width = container.clientWidth * dpr;
            graphCanvas.height = container.clientHeight * dpr;
            
            // On met √† l'√©chelle pour garder les proportions
            const scaleX = graphCanvas.width / 650;
            const scaleY = graphCanvas.height / 350;
            
            ctxGraph.setTransform(1, 0, 0, 1, 0, 0); 
            ctxGraph.scale(scaleX, scaleY);
        }
        window.addEventListener('resize', () => { resizeGraphCanvas(); drawGraph(); });

        function drawGraph() {
            ctxGraph.save();
            ctxGraph.setTransform(1, 0, 0, 1, 0, 0);
            ctxGraph.clearRect(0, 0, graphCanvas.width, graphCanvas.height);
            ctxGraph.restore();

            edges.forEach(edge => {
                const start = nodes[edge.from];
                const end = nodes[edge.to];
                ctxGraph.beginPath();
                ctxGraph.moveTo(start.x, start.y);
                ctxGraph.lineTo(end.x, end.y);
                ctxGraph.strokeStyle = (dijkstraState.visited.includes(edge.from) && dijkstraState.visited.includes(edge.to)) ? '#94a3b8' : '#cbd5e1';
                ctxGraph.lineWidth = 2;
                ctxGraph.stroke();

                const midX = (start.x + end.x) / 2;
                const midY = (start.y + end.y) / 2;
                ctxGraph.fillStyle = '#fff';
                ctxGraph.beginPath(); ctxGraph.arc(midX, midY, 12, 0, 2*Math.PI); ctxGraph.fill();
                ctxGraph.strokeStyle = '#e2e8f0'; ctxGraph.lineWidth = 1; ctxGraph.stroke();
                
                ctxGraph.fillStyle = '#64748b'; ctxGraph.font = '12px Inter';
                ctxGraph.textAlign = 'center'; ctxGraph.textBaseline = 'middle';
                ctxGraph.fillText(edge.weight, midX, midY);
            });

            for (let id in nodes) {
                const node = nodes[id];
                ctxGraph.beginPath(); ctxGraph.arc(node.x, node.y, 25, 0, 2 * Math.PI);
                if (id === dijkstraState.current) ctxGraph.fillStyle = '#f59e0b';
                else if (dijkstraState.visited.includes(id)) ctxGraph.fillStyle = '#10b981';
                else ctxGraph.fillStyle = '#fff';
                ctxGraph.fill();
                
                ctxGraph.strokeStyle = (id === 'S' || id === 'E') ? '#334155' : '#94a3b8';
                ctxGraph.lineWidth = 3; ctxGraph.stroke();

                ctxGraph.fillStyle = (id === dijkstraState.current || dijkstraState.visited.includes(id)) ? '#fff' : '#334155';
                ctxGraph.font = 'bold 16px Inter'; ctxGraph.textAlign = 'center'; ctxGraph.textBaseline = 'middle';
                ctxGraph.fillText(node.label, node.x, node.y);

                const dist = dijkstraState.distances[id];
                ctxGraph.fillStyle = '#0f172a'; ctxGraph.font = 'bold 14px Inter';
                ctxGraph.fillText(dist === Infinity ? '‚àû' : dist, node.x, node.y - 35);
            }
        }

        function resetDijkstra() {
            dijkstraState = { step: 0, distances: {}, visited: [], current: null };
            for (let id in nodes) dijkstraState.distances[id] = Infinity;
            dijkstraState.distances['S'] = 0;
            document.getElementById('dijkstra-status').innerHTML = '<p class="text-sm text-stone-600 bg-white p-2 rounded border border-stone-200">Initialisation : Distance(S) = 0, autres = ‚àû.</p>';
            document.getElementById('btn-step').disabled = false;
            document.getElementById('btn-step').innerText = "√âtape Suivante";
            document.getElementById('btn-step').classList.remove('opacity-50', 'cursor-not-allowed');
            drawGraph();
        }

        function stepDijkstra() {
            const { distances, visited } = dijkstraState;
            let u = null, min = Infinity;
            for (let id in nodes) {
                if (!visited.includes(id) && distances[id] < min) { min = distances[id]; u = id; }
            }

            if (u === null) {
                dijkstraState.current = null;
                const statusEl = document.getElementById('dijkstra-status');
                const newItem = document.createElement('p');
                newItem.className = "text-sm font-bold text-emerald-600 mt-2 bg-emerald-50 p-2 rounded border border-emerald-100";
                newItem.innerText = "Algorithme termin√© !";
                statusEl.insertBefore(newItem, statusEl.firstChild);
                document.getElementById('btn-step').disabled = true;
                document.getElementById('btn-step').innerText = "Termin√©";
                document.getElementById('btn-step').classList.add('opacity-50', 'cursor-not-allowed');
                drawGraph();
                return;
            }

            dijkstraState.current = u; dijkstraState.visited.push(u);
            let updates = [];
            edges.forEach(edge => {
                if (edge.from === u) {
                    let v = edge.to;
                    if (!visited.includes(v)) {
                        let alt = distances[u] + edge.weight;
                        if (alt < distances[v]) { distances[v] = alt; updates.push(`${v} (${alt})`); }
                    }
                }
            });

            let msg = `Visite de <strong>${u}</strong>. ` + (updates.length > 0 ? `Mise √† jour : ${updates.join(', ')}.` : `Pas de mise √† jour.`);
            const statusEl = document.getElementById('dijkstra-status');
            const newItem = document.createElement('div');
            newItem.className = "text-sm text-stone-600 bg-white p-2 rounded border border-stone-100 mb-2 shadow-sm";
            newItem.innerHTML = msg;
            statusEl.insertBefore(newItem, statusEl.firstChild);
            drawGraph();
        }

        // --- SECTION 3: MARKOV LOGIC (CHART + GRAPH) ---
        let markovChart = null;
        const mkCanvas = document.getElementById('markovGraphCanvas');
        const ctxMk = mkCanvas.getContext('2d');

        // Dessin du graphe probabiliste (A <-> B)
        function resizeMarkovCanvas() {
            const container = document.getElementById('markovGraphContainer');
            if (container.clientWidth === 0) return;
            const dpr = window.devicePixelRatio || 1;
            mkCanvas.width = container.clientWidth * dpr;
            mkCanvas.height = container.clientHeight * dpr;
            
            ctxMk.setTransform(1, 0, 0, 1, 0, 0);
            ctxMk.scale(dpr, dpr);
        }
        window.addEventListener('resize', () => { resizeMarkovCanvas(); updateMarkov(); });

        function drawArrow(ctx, fromX, fromY, toX, toY, text, color, curveDir) {
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = 2;
            
            // Courbe quadratique pour faire un arc
            const midX = (fromX + toX) / 2;
            const midY = (fromY + toY) / 2;
            const cpY = midY + (curveDir * 60); // Control point Y offset
            
            ctx.moveTo(fromX, fromY);
            ctx.quadraticCurveTo(midX, cpY, toX, toY);
            ctx.stroke();

            // T√™te de fl√®che
            const angle = Math.atan2(toY - cpY, toX - midX);
            const headlen = 10;
            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), toY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), toY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.fill();

            // Label (texte)
            const labelX = midX; 
            const labelY = cpY * 0.85 + midY * 0.15;
            
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(labelX, labelY, 14, 0, 2*Math.PI); ctx.fill();
            ctx.strokeStyle = color; ctx.lineWidth=1; ctx.stroke();
            
            ctx.fillStyle = color;
            ctx.font = 'bold 12px Inter';
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillText(text, labelX, labelY);
        }

        function drawLoop(ctx, x, y, text, color, isLeft) {
            ctx.beginPath();
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = 2;
            
            const offset = isLeft ? -1 : 1;
            // Dessine une oreille (cercle excentr√©)
            ctx.arc(x + (offset * 30), y - 30, 20, 0, 2*Math.PI);
            ctx.stroke();

            // Texte
            ctx.fillStyle = '#fff';
            ctx.beginPath(); ctx.arc(x + (offset * 30), y - 55, 14, 0, 2*Math.PI); ctx.fill();
            ctx.strokeStyle = color; ctx.lineWidth=1; ctx.stroke();
            
            ctx.fillStyle = color;
            ctx.font = 'bold 12px Inter';
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
            ctx.fillText(text, x + (offset * 30), y - 55);
        }

        function drawMarkovGraph(tAA, tAB, tBA, tBB) {
            const width = mkCanvas.width / (window.devicePixelRatio || 1);
            const height = mkCanvas.height / (window.devicePixelRatio || 1);
            ctxMk.clearRect(0, 0, width, height);

            const posA = {x: width * 0.3, y: height/2 + 20};
            const posB = {x: width * 0.7, y: height/2 + 20};
            const r = 30;

            // Fl√®ches
            // A -> B (Courbe haut)
            drawArrow(ctxMk, posA.x + r*0.5, posA.y - r*0.8, posB.x - r*0.5, posB.y - r*0.8, tAB, '#d97706', -1);
            // B -> A (Courbe bas)
            drawArrow(ctxMk, posB.x - r*0.5, posB.y + r*0.8, posA.x + r*0.5, posA.y + r*0.8, tBA, '#10b981', 1);

            // Boucles sur soi-m√™me
            drawLoop(ctxMk, posA.x, posA.y, tAA, '#d97706', true);
            drawLoop(ctxMk, posB.x, posB.y, tBB, '#10b981', false);

            // N≈ìuds
            [posA, posB].forEach((pos, idx) => {
                ctxMk.beginPath();
                ctxMk.arc(pos.x, pos.y, r, 0, 2*Math.PI);
                ctxMk.fillStyle = idx === 0 ? '#fff7ed' : '#ecfdf5'; 
                ctxMk.fill();
                ctxMk.strokeStyle = idx === 0 ? '#d97706' : '#10b981';
                ctxMk.lineWidth = 3;
                ctxMk.stroke();
                
                ctxMk.fillStyle = '#334155';
                ctxMk.font = 'bold 18px Inter';
                ctxMk.textAlign = 'center'; ctxMk.textBaseline = 'middle';
                ctxMk.fillText(idx === 0 ? 'A' : 'B', pos.x, pos.y);
            });
        }

        function initMarkovChart() {
            const ctxM = document.getElementById('markovChart').getContext('2d');
            markovChart = new Chart(ctxM, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        { label: '√âtat A', borderColor: '#d97706', backgroundColor: 'rgba(217, 119, 6, 0.1)', data: [], tension: 0.3, fill: false, pointRadius: 2 },
                        { label: '√âtat B', borderColor: '#10b981', backgroundColor: 'rgba(16, 185, 129, 0.1)', data: [], tension: 0.3, fill: false, pointRadius: 2 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { y: { min: 0, max: 1, title: { display: true, text: 'Probabilit√©' } }, x: { title: { display: true, text: '√âtapes (n)' } } },
                    plugins: { legend: { position: 'top' }, tooltip: { mode: 'index', intersect: false } }
                }
            });
            updateMarkov();
        }

        function updateMarkov() {
            const tAA = parseFloat(document.getElementById('t-aa').value);
            const tBA = parseFloat(document.getElementById('t-ba').value);
            const tAB = parseFloat((1 - tAA).toFixed(2));
            const tBB = parseFloat((1 - tBA).toFixed(2));
            
            document.getElementById('t-ab').innerText = tAB;
            document.getElementById('t-bb').innerText = tBB;

            // Mettre √† jour le dessin du graphe
            resizeMarkovCanvas(); 
            drawMarkovGraph(tAA, tAB, tBA, tBB);

            const p0A = parseFloat(document.getElementById('p0-slider').value);
            const p0B = parseFloat((1 - p0A).toFixed(2));
            document.getElementById('p0-a-val').innerText = p0A;
            document.getElementById('p0-b-val').innerText = p0B;

            const steps = 15;
            let currentA = p0A, currentB = p0B;
            let dataA = [currentA], dataB = [currentB], labels = [0];

            for (let i = 1; i <= steps; i++) {
                let nextA = (currentA * tAA) + (currentB * tBA);
                let nextB = (currentA * tAB) + (currentB * tBB);
                dataA.push(nextA); dataB.push(nextB); labels.push(i);
                currentA = nextA; currentB = nextB;
            }

            markovChart.data.labels = labels;
            markovChart.data.datasets[0].data = dataA;
            markovChart.data.datasets[1].data = dataB;
            markovChart.update();

            const den = (1 - tAA + tBA);
            if (den !== 0) {
                 const sA = tBA / den;
                 document.getElementById('stable-a').innerText = sA.toFixed(3);
                 document.getElementById('stable-b').innerText = (1 - sA).toFixed(3);
            } else {
                 document.getElementById('stable-a').innerText = "Ind√©fini";
                 document.getElementById('stable-b').innerText = "Ind√©fini";
            }
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            calculateMatrix();
            resetDijkstra();
            initMarkovChart();
            resizeGraphCanvas();
        });

    </script>
</body>
</html>
